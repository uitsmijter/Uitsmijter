name: "Helm"
description: "Build helm packages"
author: "aus der Technik | Uitsmijter"

runs:
  using: composite
  steps:
    - name: Build helm release
      shell: bash
      run: ./tooling.sh helm
    - name: Store helm release package
      uses: actions/upload-artifact@v3
      with:
        name: helm-package
        path: |
          ./Deployment/Release/**-**.tgz
    - name: Create charts dir
      shell: bash
      run: |
        mkdir ./charts
        tar -xvf ./Deployment/Release/uitsmijter-**.tgz -C ./charts --strip-components 1
    - name: Configure Git
      shell: bash
      run: |
        git config user.name "$GITHUB_ACTOR"
        git config user.email "$GITHUB_ACTOR@users.noreply.github.com"
    - name: Run chart-releaser
      uses: helm/chart-releaser-action@v1.6.0
      with:
        charts_dir: charts
      env:
        CR_TOKEN: ${{ github.token }}
